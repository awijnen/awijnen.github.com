
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Building my first data-driven Sinatra app and deploying it to Heroku - Anthony Wijnen</title>
  <meta name="author" content="Anthony Wijnen">

  
  <meta name="description" content="We just wrapped up our third week at the Flatiron School. It&#8217;s been intense, exhausting, but at the same time insanely gratifying. One of the &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://awijnen.github.com/blog/2013/02/25/building-your-first-sinatra-app-and-deploying-to-heroku">
  <link href="/favicon.ico" rel="icon">
  
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Anthony Wijnen" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-38874027-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   class="no-sidebar"  >
  <header role="banner"><hgroup>
  <h1>Anthony Wijnen</h1>
  
    <h2><a href="/">AW</a></h2>
  
</hgroup>

</header>
  <nav role="navigation">
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:awijnen.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/about">About</a></li>
  <li><a href="/projects">Projects</a></li>
  <li><a href="https://github.com/awijnen">Code</a></li>
  <li><a href="/blog/archives"> Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Building My First Data-driven Sinatra App and Deploying It to Heroku</h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-02-25T00:06:00-05:00" pubdate data-updated="true">Feb 25<span>th</span>, 2013</time>
        
      </p>
    
  </header>


<div class="entry-content"><div class='container'>
  <p>We just wrapped up our third week at the <a href="http://www.flatironschool.com">Flatiron School</a>. It&#8217;s been intense, exhausting, but at the same time insanely gratifying. One of the things that kept us all sane is our weekly tradition called &#8216;Feeling Friday&#8217;, in which we collectively share what&#8217;s on our mind.</p>

  <p>That being said, I noticed that 1) some people get somewhat uncomfortable when they have to open up in public, and 2) others were scrambling to get their thoughts together, when being put on the spot. I&#8217;ve been in the second category before. The &#8216;Feeling Friday Web App&#8217; should come in handy to make this whole experience even more awesome by allowing anonymous sharing whenever you&#8217;re up for it. At the same time it&#8217;s a great way to learn about data-driven Sinatra web apps using the DataMapper gem, and deploying them to Heroku. Both of which I had never done before up until 24h ago.</p>

  <p>Before moving any further, if you got cold shivers reading the word Sinatra or DataMapper, I suggest you read both <a href="http://net.tutsplus.com/tutorials/ruby/singing-with-sinatra/">this</a> and <a href="http://www.blacktm.com/talks/building_web_apps_with_rack_and_sinatra">this</a> tutorial first.</p>

  <p>Let&#8217;s get cracking. Here&#8217;s what we&#8217;ll use to build our app:</p>

  <ul>
    <li>Ruby</li>
    <li>Rack</li>
    <li>Sinatra</li>
    <li>DataMapper gem</li>
    <li>PostgreSQL</li>
    <li>HTML/CSS</li>
    <li>Git (for version control)</li>
    <li>Heroku</li>    
  </ul>

  <h3>Easy does it</h3>
  <p>Let&#8217;s start it off simple. We first create a new folder and add the brains of the operation, i.e. <code>feelingfriday.rb</code>. Here are the gems we&#8217;ll be using:</p>

    
<figure class='code'><figcaption><span>Gems to include in feelingfriday.rb  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>    <span class="nb">require</span> <span class="s1">&#39;rubygems&#39;</span>
</span><span class='line'>    <span class="nb">require</span> <span class="s1">&#39;sinatra&#39;</span>
</span><span class='line'>    <span class="nb">require</span> <span class="s1">&#39;data_mapper&#39;</span>
</span><span class='line'>    <span class="nb">require</span> <span class="s1">&#39;dm-postgres-adapter&#39;</span>
</span></code></pre></td></tr></table></div></figure>


  <p>We’re going to be using a PostgreSQL database to store the notes, and we’ll use the gem <a href="http://datamapper.org/">DataMapper</a> to communicate with the database. DataMapper is a gem that packages all the code you need to automatically map the classes you create to entries in the database. For example, we&#8217;ll create a class Notes, which DataMapper will &#8216;map&#8217; to a Notes table in the database. Every time you create a new Notes instance (i.e. you create a note), DataMapper will make sure it saves it to the database. Finally, you&#8217;ll need to specify an adapter gem, that&#8217;ll allow DataMapper to talk to the type of database you selected (in our case PostgreSQL).</p>

  <h3>Build your model and Setup the Database</h3>

  <p>Let&#8217;s take advantage of <a href="http://datamapper.org/">DataMapper</a> right away. We&#8217;ll create the class Note, and Comment, which are the two key building block of our Feeling Friday app, and we&#8217;ll include DataMapper as a resource. This allows us to specify properties, that&#8217;ll map to columns in the database table.</p>

    
<figure class='code'><figcaption><span>Set up Database in feelingfriday.rb  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>      <span class="no">DataMapper</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="ss">:default</span><span class="p">,</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;DATABASE_URL&#39;</span><span class="o">]</span> <span class="o">||</span> <span class="s1">&#39;postgres://localhost/mydb&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">class</span> <span class="nc">Note</span>
</span><span class='line'>        <span class="kp">include</span> <span class="ss">DataMapper</span><span class="p">:</span><span class="ss">:Resource</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1"># setting up a Notes table</span>
</span><span class='line'>        <span class="c1"># setting up database schema with 5 columns</span>
</span><span class='line'>        <span class="n">property</span> <span class="ss">:id</span><span class="p">,</span> <span class="no">Serial</span> <span class="c1"># serial will auto increment</span>
</span><span class='line'>        <span class="n">property</span> <span class="ss">:content</span><span class="p">,</span> <span class="no">Text</span><span class="p">,</span> <span class="ss">:required</span> <span class="o">=&gt;</span> <span class="kp">true</span>
</span><span class='line'>        <span class="n">property</span> <span class="ss">:complete</span><span class="p">,</span> <span class="no">Boolean</span><span class="p">,</span> <span class="ss">:required</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:default</span> <span class="o">=&gt;</span> <span class="kp">false</span>
</span><span class='line'>        <span class="n">property</span> <span class="ss">:created_at</span><span class="p">,</span> <span class="no">DateTime</span>
</span><span class='line'>        <span class="n">property</span> <span class="ss">:updated_at</span><span class="p">,</span> <span class="no">DateTime</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">has</span> <span class="n">n</span><span class="p">,</span> <span class="ss">:comments</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">class</span> <span class="nc">Comment</span>
</span><span class='line'>        <span class="kp">include</span> <span class="ss">DataMapper</span><span class="p">:</span><span class="ss">:Resource</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">property</span> <span class="ss">:id</span><span class="p">,</span> <span class="no">Serial</span>
</span><span class='line'>        <span class="n">property</span> <span class="ss">:content</span><span class="p">,</span> <span class="no">Text</span>
</span><span class='line'>        <span class="n">property</span> <span class="ss">:created_at</span><span class="p">,</span> <span class="no">DateTime</span>
</span><span class='line'>        <span class="n">property</span> <span class="ss">:updated_at</span><span class="p">,</span> <span class="no">DateTime</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">belongs_to</span> <span class="ss">:note</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>      <span class="no">DataMapper</span><span class="o">.</span><span class="n">finalize</span><span class="o">.</span><span class="n">auto_upgrade!</span>
</span></code></pre></td></tr></table></div></figure>


      <p></p>

  <h3>Setting up the Home Page</h3>
  <p>Once we&#8217;re done it&#8217;ll look like this, but let&#8217;s take it one step at a time.</p>
  <img src="/images/feelingfridayapp.png">

  <p>First, let&#8217;s go into <code>feelingfriday.rb</code> and</p>

  
<figure class='code'><figcaption><span>Get all emotions from the database and display them in the home page  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>      <span class="n">get</span> <span class="s1">&#39;/&#39;</span> <span class="k">do</span>
</span><span class='line'>        <span class="vi">@notes</span> <span class="o">=</span> <span class="no">Note</span><span class="o">.</span><span class="n">all</span> <span class="ss">:order</span> <span class="o">=&gt;</span> <span class="ss">:id</span><span class="o">.</span><span class="n">desc</span>
</span><span class='line'>        <span class="vi">@title</span> <span class="o">=</span> <span class="s2">&quot;All Emotions&quot;</span>
</span><span class='line'>        <span class="n">erb</span> <span class="ss">:home</span>
</span><span class='line'>      <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


  <p>On the second line you see how we retrieve all the notes from the database. If you’ve used ActiveRecord (the ORM used in Rails) before, DataMapper’s syntax will feel very familiar. The notes are assigned to the <code>@notes</code> instance variable. It’s important to use instance variables (that’s variables beginning with an @) so that they’ll be accessible from within the view file.
  </p>
  <p>We set the <code>@title</code> instance variable, and load the views/home.erb view file through the ERB parser.</p> 
  <p>Create the views/home.erb view file and start it off with the following:
  </p>

  
<figure class='code'><figcaption><span>Create a view for the home page  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='erb'><span class='line'><span class="x">      &lt;section id=&quot;add&quot;&gt;</span>
</span><span class='line'><span class="x">      &lt;form action=&quot;/&quot; method=&quot;post&quot;&gt;</span>
</span><span class='line'><span class="x">        &lt;textarea name=&quot;content&quot; placeholder=&quot;Your deepest emotions go here&amp;hellip;&quot;&gt;&lt;/textarea&gt;</span>
</span><span class='line'><span class="x">        &lt;input type=&quot;submit&quot; value=&quot;Save emotion&quot;&gt;</span>
</span><span class='line'><span class="x">      &lt;/form&gt;</span>
</span><span class='line'><span class="x">      &lt;/section&gt;</span>
</span><span class='line'><span class="x">      </span><span class="cp">&lt;%</span> <span class="vi">@notes</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">note</span><span class="o">|</span> <span class="cp">%&gt;</span><span class="x">  </span>
</span><span class='line'><span class="x">        &lt;article&gt;  </span>
</span><span class='line'><span class="x">          &lt;p&gt;  </span>
</span><span class='line'><span class="x">            </span><span class="cp">&lt;%=</span> <span class="n">note</span><span class="o">.</span><span class="n">content</span> <span class="cp">%&gt;</span><span class="x">  </span>
</span><span class='line'><span class="x">            &lt;span&gt;&lt;a href=&quot;/</span><span class="cp">&lt;%=</span> <span class="n">note</span><span class="o">.</span><span class="n">id</span> <span class="cp">%&gt;</span><span class="x">&quot;&gt;[edit]&lt;/a&gt;&lt;/span&gt;  </span>
</span><span class='line'><span class="x">          &lt;/p&gt;   </span>
</span><span class='line'><span class="x">          &lt;p class=&quot;meta&quot;&gt;Created: </span><span class="cp">&lt;%=</span> <span class="n">note</span><span class="o">.</span><span class="n">created_at</span> <span class="cp">%&gt;</span><span class="x">&lt;/p&gt;  </span>
</span><span class='line'><span class="x">        &lt;/article&gt;</span>
</span><span class='line'><span class="x">        &lt;br&gt;</span>
</span><span class='line'><span class="x">      </span><span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"> </span>
</span><span class='line'><span class="x">      &lt;p class=&quot;remove&quot;&gt;Remove all this Emotional Crap!&lt;a href=&#39;/migrate&#39;&gt;&lt;input type=&quot;submit&quot; name=&quot;Submit&quot;&gt;&lt;/a&gt;&lt;/p&gt;</span>
</span></code></pre></td></tr></table></div></figure>


  <h3>Create a layout</h3>

  <h3>Time for some Style</h3>

  <h3>What&#8217;s Next?</h3>


</div>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn"><a href="/about" title="About the author (Anthony Wijnen)" rel="author">Anthony Wijnen</a></span></span>

      








  


<time datetime="2013-02-25T00:06:00-05:00" pubdate data-updated="true">Feb 25<span>th</span>, 2013</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/flatiron-school/'>Flatiron School</a>, <a class='category' href='/blog/categories/html5-boilerplate/'>HTML5 boilerplate</a>, <a class='category' href='/blog/categories/heroku/'>Heroku</a>, <a class='category' href='/blog/categories/postgres/'>Postgres</a>, <a class='category' href='/blog/categories/ruby/'>Ruby</a>, <a class='category' href='/blog/categories/sinatra/'>Sinatra</a>, <a class='category' href='/blog/categories/technical/'>technical</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://awijnen.github.com/blog/2013/02/25/building-your-first-sinatra-app-and-deploying-to-heroku/" data-via="anthonywijnen" data-counturl="http://awijnen.github.com/blog/2013/02/25/building-your-first-sinatra-app-and-deploying-to-heroku/" >Tweet</a>
  
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2013/02/12/programming-used-to-be-my-kryptonite/" title="Previous Post: Programming used to be my kryptonite">&laquo; Programming used to be my kryptonite</a>
      
      
    </p>
  </footer>
</article>

</div>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Anthony Wijnen -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
